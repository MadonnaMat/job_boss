#!/usr/bin/env ruby

require 'rubygems'
require 'daemons'

working_dir = Dir.pwd

daemons_options = {
  :dir_mode   => :script,
  :dir        => 'pids',
  :stop_proc  => proc { boss.stop }
}

Daemons.run_proc('job_boss', daemons_options) do
  Dir.chdir(working_dir)

  require 'job_boss/boss'

  command, daemon_options, app_options = Daemons::Controller.split_argv(ARGV)

  JobBoss::Boss.config.parse_args(app_options, :working_dir => working_dir)

  boss = JobBoss::Boss.new
  boss.start
end
